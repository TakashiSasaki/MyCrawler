<!DOCTYPE html>
<html>
	<head>
		<title>Tables</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="jquery.mobile-1.1.0.min.css" />
		<script src="jquery-1.7.1.min.js"></script>
		<script src="jquery.mobile-1.1.0.min.js"></script>
	</head>
	<body>
		<script type="text/javascript"
		src='https://www.google.com/jsapi?autoload={
		"modules":[{"name":"visualization","version":"1"}]
		}'></script>
		<script type="text/javascript">
			$("#pageRecord").live('pageshow', drawRecord);
			function drawRecord(event) {
				//alert("drawRecord");
				var wrapRecord = new google.visualization.ChartWrapper({
					"dataSourceUrl" : "/api/Record",
					//"dataSourceUrl" : "http://spreadsheets.google.com/tq?key=pCQbetd-CptGXxxQIG7VFIQ&pub=1",
					"refreshInterval" : 5
				});
				wrapRecord.setChartType('Table');
				wrapRecord.setContainerId('tableRecord');
				wrapRecord.draw();
			}


			$("#pageCrawl").live('pageshow', queryCrawl);
			function queryCrawl() {
				query = new google.visualization.Query("/api/Crawl", {"sendMethod": "xhr"});
				query.setTimeout(10);
				query.setRefreshInterval(5);
				query.send(function (response) {
					data_table = response.getDataTable();
					wrapCrawl = new google.visualization.ChartWrapper();
					wrapCrawl.setDataTable(data_table);
					wrapCrawl.setChartType('Table');
					wrapCrawl.setContainerId('tableCrawl');
					wrapCrawl.draw();
				});
			}


			$("#pageSyncStatus").live('pageshow', drawSyncStatus);
			function drawSyncStatus(event) {
				//alert("drawSyncStatus");
				wrapSyncStatus = new google.visualization.ChartWrapper({
					"dataSourceUrl" : '/api/SyncStatus',
					"refreshInterval" : 5
				});
				wrapSyncStatus.setChartType('Table');
				wrapSyncStatus.setContainerId('tableSyncStatus');
				wrapSyncStatus.draw();
			}
		</script>

		<div data-role="page" id="pageRecord">
			<div data-role="navbar">
				<ul>
					<li>
						<a href="#pageRecord" class="ui-btn-active">Record</a>
					</li>
					<li>
						<a href="#pageCrawl">Crawl</a>
					</li>
					<li>
						<a href="#pageSyncStatus">SyncStatus</a>
					</li>
				</ul>
			</div>
			<div data-role="content">
				<div id="tableRecord"></div>
			</div>
			<div data-role="footer">
				<span onclick="dropTable()" data-role="button">drop</span>
				<script>
					function dropTable() {
						$.ajax('create');
						$.mobile.activePage().trigger('create');
					}
				</script>
			</div>
		</div>

		<div data-role="page" id="pageCrawl">
			<div data-role="navbar">
				<ul>
					<li>
						<a href="#pageRecord">Record</a>
					</li>
					<li>
						<a href="#pageCrawl" class="ui-btn-active">Crawl</a>
					</li>
					<li>
						<a href="#pageSyncStatus">SyncStatus</a>
					</li>
				</ul>
			</div>
			<div data-role="content">
				<div id="tableCrawl">
					koko
				</div>
			</div>
			<div data-role="footer">
				<span onclick="dropCrawl()" data-role="button">drop</span>
				<script>
					function dropCrawl() {
						$.ajax('/api/Crawl/drop');
						queryCrawl();
					}
				</script>
				<span onclick="createCrawl()" data-role="button">create</span>
				<script>
					function createCrawl() {
						$.ajax('/api/Crawl/create');
						queryCrawl();
					}
				</script>
				<span onclick="dummyCrawl()" data-role="button">dummy</span>
				<script>
					function dummyCrawl() {
						$.ajax('/api/Crawl/dummy');
						queryCrawl();
					}
				</script>
			</div>
		</div>

		<div data-role="page" id="pageSyncStatus">
			<div data-role="navbar">
				<ul>
					<li>
						<a href="#pageRecord">Record</a>
					</li>
					<li>
						<a href="#pageCrawl">Crawl</a>
					</li>
					<li>
						<a href="#pageSyncStatus" class="ui-btn-active">SyncStatus</a>
					</li>
				</ul>
			</div>
			<div data-role="content">
				<div id="tableSyncStatus"></div>
			</div>
			<div data-role="footer">
				<h1>Footer2</h1>
			</div>
		</div>
	</body>
</html>